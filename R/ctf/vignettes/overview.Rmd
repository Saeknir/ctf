---
title: Overview
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Overview}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE, eval=TRUE}
# For development, before I implement.
#knitr::opts_chunk$set(eval = FALSE, echo = TRUE)
```

## Introduction

Column Text Format (CTF) stores the columns of tabular data in plain text, combining performance with simplicity.
CTF is a general purpose data storage format like CSV, but faster when loading a subset of the columns, because it's a column store.
The storage itself consists of two components: plain text files for each column in a table or data frame, and a metadata file describing the data.
The metadata file contains information required for fast, accurate data loading, such as the type of each column, and the number of rows.
This package provides functions to read and write CTF data from R.

#### When to use?

CTF is useful for teaching, particularly when working with large data sets.
It's also good for those who prefer transparent plain text over binary formats.

#### When not to use?

CTF is new as of 2021, and subject to significant changes.
For serious production use consider established columnar storage technologies such as [HDF5](https://www.hdfgroup.org/) or [Apache Parquet](https://parquet.apache.org/).


## Quick Start

```{R}
library(ctf)
```

The following examples use R's builtin `iris` dataset.

First, let's save `iris` in CTF format inside `iris_ctf_data`, a subdirectory of our temporary directory.

```{R}
d <- file.path(tempdir(), "iris_ctf_data")
write.ctf(iris, d)
```

The code above created the directory `iris_ctf_data`, and wrote files corresponding to the columns in `iris`, plus one file for the metadata.

```{R}
list.files(d)

colnames(iris)
```

```{R, include=FALSE}
files = list.files(d)

if(!(sum(endsWith(files, ".json")) == 1))
    stop("Expected 1 JSON file with metadata.")

if(!(length(files) == length(iris) + 1))
    stop("Expected files for each column, plus one for metadata.")
```

The column files are just plain text.
Let's verify by reading the first 5 lines.

```{R}
pl_file <- file.path(d, "Petal.Length")
readLines(pl_file, n = 5L)

iris[1:5, "Petal.Length"]
```

```{R, include=FALSE}
from_file = readLines(pl_file, n = 5L)
expected = iris[1:5, "Petal.Length"]

if(!all.equal(as.numeric(from_file), expected))
    stop("Data from ctf doesn't match.")
```

We can read the data saved in ctf format back into R as `iris2`, and make sure the data matches our original `iris` data.

```{R}
iris2 <- read.ctf(d)
head(iris2)

# Same thing:
head(iris)
```

Clean up:

```{R}
unlink(d, recursive = TRUE)
```
